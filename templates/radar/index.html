<!--
/* * Nom de l'application : ATM-RDC
 * Description : Source file: index.html
 * Produit de : MOA Digital Agency, www.myoneart.com
 * Fait par : Aisance KALONJI, www.aisancekalonji.com
 * Auditer par : La CyberConfiance, www.cyberconfiance.com
 */
-->
{% extends "base.html" %}

{% block title %}{{ t('radar.title') }} - {{ t('app_name') }}{% endblock %}
{% block page_title %}{{ t('radar.live_monitor') }}{% endblock %}
{% block page_subtitle %}{{ t('dashboard.real_time') }} - {{ t('dashboard.rdc_airspace') }}{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/radar/index.css') }}">
{% endblock %}

{% block content %}
<div class="flex gap-6 h-full">
    <div class="flex-1">
        <div class="bg-dark-400 rounded-xl border border-dark-100 relative">
            <div class="p-4 border-b border-dark-100 flex items-center justify-between relative z-20">
                <div class="flex items-center gap-4">
                    <h3 class="font-semibold text-white">
                        <i class="fas fa-radar mr-2 text-primary-400"></i>
                        {{ t('radar.map_title') }}
                    </h3>
                    <div class="flex items-center gap-2 text-sm">
                        <span class="w-2 h-2 bg-green-400 rounded-full status-dot"></span>
                        <span class="text-green-400" id="flights-count" data-testid="text-flights-count">0 {{ t('radar.flights_active') }}</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm text-gray-400">
                        <i class="fas fa-clock"></i>
                        <span id="last-update" data-testid="text-last-update">--:--:--</span>
                    </div>
                </div>
                
                <div class="flex items-center gap-2">
                    <button onclick="zoomToRDC()" class="tooltip-btn w-10 h-10 flex items-center justify-center bg-dark-300 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors" data-testid="btn-zoom-rdc" data-tooltip="{{ t('radar.zoom_rdc') }}">
                        <i class="fas fa-globe-africa"></i>
                    </button>
                    <button onclick="toggleLayerControl()" class="tooltip-btn w-10 h-10 flex items-center justify-center bg-dark-300 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors" data-testid="btn-layers" data-tooltip="{{ t('radar.layers') }}">
                        <i class="fas fa-layer-group"></i>
                    </button>
                    <button onclick="toggleWeather()" class="tooltip-btn w-10 h-10 flex items-center justify-center bg-dark-300 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors" id="btn-weather" data-testid="btn-weather" data-tooltip="{{ t('radar.weather') }}">
                        <i class="fas fa-cloud"></i>
                    </button>
                    <button onclick="toggleScan()" class="tooltip-btn w-10 h-10 flex items-center justify-center bg-dark-300 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors" id="btn-scan" data-tooltip="{{ t('radar.scan_effect') }}">
                        <i class="fas fa-satellite-dish"></i>
                    </button>
                    <button onclick="toggleFullscreen()" class="tooltip-btn w-10 h-10 flex items-center justify-center bg-dark-300 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors" id="btn-fullscreen" data-testid="btn-fullscreen" data-tooltip="{{ t('radar.fullscreen') }}">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button onclick="refreshFlights()" class="tooltip-btn w-10 h-10 flex items-center justify-center bg-primary-600 text-white hover:bg-primary-500 rounded-lg transition-colors" id="btn-refresh" data-testid="btn-refresh" data-tooltip="{{ t('radar.refresh') }}">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </div>
            
            <div id="radar-map" data-testid="radar-map">
                <div id="radar-scan-overlay" class="radar-scan-overlay">
                    <div class="radar-scan"></div>
                </div>
            </div>
            
            <!-- Layer Control Panel -->
            <div class="layer-control" id="layer-control">
                <div class="text-white font-medium mb-2 px-2">{{ t('radar.layer_control') }}</div>
                <label>
                    <input type="checkbox" checked id="layer-boundary" onchange="toggleLayer('boundary')">
                    <span class="text-gray-300 text-sm">{{ t('radar.layer_boundary') }}</span>
                </label>
                <label>
                    <input type="checkbox" checked id="layer-airports" onchange="toggleLayer('airports')">
                    <span class="text-gray-300 text-sm">{{ t('radar.layer_airports') }}</span>
                </label>
                <label>
                    <input type="checkbox" checked id="layer-flights" onchange="toggleLayer('flights')">
                    <span class="text-gray-300 text-sm">{{ t('radar.layer_flights') }}</span>
                </label>
                <label>
                    <input type="checkbox" id="layer-weather" onchange="toggleLayer('weather')">
                    <span class="text-gray-300 text-sm">{{ t('radar.layer_weather') }}</span>
                </label>
                <label>
                    <input type="checkbox" id="layer-precipitation" onchange="toggleLayer('precipitation')">
                    <span class="text-gray-300 text-sm">{{ t('radar.layer_precip') }}</span>
                </label>
                <div class="mt-3 px-2">
                    <div class="text-gray-400 text-xs mb-1">{{ t('radar.basemap') }}</div>
                    <select id="basemap-select" onchange="changeBasemap()" class="w-full px-2 py-1 bg-dark-300 border border-dark-100 rounded text-white text-sm">
                        <option value="dark">{{ t('radar.basemap_dark') }}</option>
                        <option value="satellite">{{ t('radar.basemap_satellite') }}</option>
                        <option value="streets">{{ t('radar.basemap_streets') }}</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    
    <div class="w-80 flex flex-col gap-4">
        <!-- Filters Panel -->
        <div class="bg-dark-400 rounded-xl border border-dark-100 p-4">
            <h4 class="font-semibold text-white mb-4">
                <i class="fas fa-filter mr-2 text-primary-400"></i>
                {{ t('radar.filters') }}
            </h4>
            
            <div class="space-y-4">
                <!-- Search -->
                <div>
                    <label class="block text-sm text-gray-400 mb-2">{{ t('radar.search') }}</label>
                    <input type="text" id="filter-search" placeholder="{{ t('radar.search_placeholder') }}"
                           class="w-full px-3 py-2 bg-dark-300 border border-dark-100 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-primary-500"
                           onkeyup="applyFilters()" data-testid="input-search">
                </div>
                
                <!-- Altitude Range -->
                <div>
                    <label class="block text-sm text-gray-400 mb-2">
                        {{ t('flights.altitude') }}: <span id="altitude-value" class="text-white">0 - 45000 ft</span>
                    </label>
                    <div class="flex gap-2 items-center">
                        <span class="text-xs text-gray-500">0</span>
                        <input type="range" id="filter-altitude-min" min="0" max="45000" value="0" step="1000"
                               class="altitude-slider flex-1" onchange="applyFilters()" data-testid="range-altitude-min">
                        <input type="range" id="filter-altitude-max" min="0" max="45000" value="45000" step="1000"
                               class="altitude-slider flex-1" onchange="applyFilters()" data-testid="range-altitude-max">
                        <span class="text-xs text-gray-500">FL450</span>
                    </div>
                </div>
                
                <!-- Operator Filter -->
                <div>
                    <label class="block text-sm text-gray-400 mb-2">{{ t('radar.operator') }}</label>
                    <select id="filter-operator" class="w-full px-3 py-2 bg-dark-300 border border-dark-100 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-primary-500"
                            onchange="applyFilters()" data-testid="select-operator">
                        <option value="all">{{ t('radar.all_operators') }}</option>
                    </select>
                </div>
                
                <!-- Status Filter -->
                <div>
                    <label class="block text-sm text-gray-400 mb-2">{{ t('flights.status') }}</label>
                    <div class="space-y-2">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" checked class="w-4 h-4 rounded border-dark-100 bg-dark-300 text-green-500 focus:ring-green-500" 
                                   data-status="in_flight" onchange="applyFilters()" data-testid="checkbox-in-flight">
                            <span class="w-2.5 h-2.5 bg-green-400 rounded-full"></span>
                            <span class="text-sm text-gray-300">{{ t('radar.filter_cruise') }}</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" checked class="w-4 h-4 rounded border-dark-100 bg-dark-300 text-yellow-500 focus:ring-yellow-500" 
                                   data-status="approaching" onchange="applyFilters()" data-testid="checkbox-approaching">
                            <span class="w-2.5 h-2.5 bg-yellow-400 rounded-full"></span>
                            <span class="text-sm text-gray-300">{{ t('radar.filter_approach') }}</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" checked class="w-4 h-4 rounded border-dark-100 bg-dark-300 text-blue-500 focus:ring-blue-500" 
                                   data-status="on_ground" onchange="applyFilters()" data-testid="checkbox-on-ground">
                            <span class="w-2.5 h-2.5 bg-blue-400 rounded-full"></span>
                            <span class="text-sm text-gray-300">{{ t('radar.filter_ground') }}</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" checked class="w-4 h-4 rounded border-dark-100 bg-dark-300 text-primary-500 focus:ring-primary-500" 
                                   data-status="in_rdc" onchange="applyFilters()" data-testid="checkbox-in-rdc">
                            <span class="w-2.5 h-2.5 bg-primary-400 rounded-full"></span>
                            <span class="text-sm text-gray-300">{{ t('radar.filter_rdc') }}</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Legend -->
        <div class="bg-dark-400 rounded-xl border border-dark-100 p-4">
            <h4 class="font-semibold text-white mb-4">
                <i class="fas fa-info-circle mr-2 text-primary-400"></i>
                {{ t('radar.legend') }}
            </h4>
            
            <div class="space-y-3 text-sm">
                <div class="flex items-center gap-3">
                    <i class="fas fa-plane text-green-400" style="transform: rotate(45deg);"></i>
                    <span class="text-gray-300">{{ t('radar.legend_cruise') }}</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-plane-departure text-yellow-400"></i>
                    <span class="text-gray-300">{{ t('radar.legend_climb') }}</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-plane-arrival text-blue-400"></i>
                    <span class="text-gray-300">{{ t('radar.legend_approach') }}</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-plane text-red-400" style="transform: rotate(45deg);"></i>
                    <span class="text-gray-300">{{ t('radar.legend_emergency') }}</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-helicopter text-purple-400"></i>
                    <span class="text-gray-300">{{ t('radar.legend_heli') }}</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-circle text-primary-400 text-xs"></i>
                    <span class="text-gray-300">{{ t('radar.legend_airport') }}</span>
                </div>
            </div>
        </div>
        
        <!-- Active Flights List -->
        <div class="bg-dark-400 rounded-xl border border-dark-100 flex-1 overflow-hidden flex flex-col">
            <div class="p-4 border-b border-dark-100 flex items-center justify-between">
                <h4 class="font-semibold text-white">
                    <i class="fas fa-list mr-2 text-primary-400"></i>
                    {{ t('radar.flights_list') }}
                </h4>
                <span class="text-xs text-gray-400" id="filtered-count" data-testid="text-filtered-count"></span>
            </div>
            
            <div class="flex-1 overflow-y-auto p-2" id="flights-list" data-testid="flights-list">
                <div class="text-center py-8 text-gray-400">
                    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                    <p class="text-sm">{{ t('common.loading') }}...</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    window.radarIndexContext = {
        i18n: {
            flights_active: "{{ t('radar.flights_active') }}",
            temp: "{{ t('radar.temp') }}",
            wind: "{{ t('radar.wind') }}",
            flight: "{{ t('flights.flight') }}",
            altitude: "{{ t('flights.altitude') }}",
            speed: "{{ t('radar.speed_abbr') }}",
            heading: "{{ t('radar.heading') }}",
            dep: "{{ t('radar.dep') }}",
            arr: "{{ t('radar.arr') }}",
            in_rdc: "{{ t('radar.in_rdc_airspace') }}",
            no_match: "{{ t('radar.no_match') }}",
            refresh: "{{ t('radar.refresh') }}",
            all_operators: "{{ t('radar.all_operators') }}",
            fullscreen: "{{ t('radar.fullscreen') }}",
            exit_fullscreen: "{{ t('radar.exit_fullscreen') }}",
            cat: "{{ t('radar.cat') }}",
            squawk: "{{ t('radar.squawk') }}",
            alt_abbr: "{{ t('radar.alt_abbr') }}"
        },
        airports: {{ airports | tojson | safe }},
        unitSettings: {{ unit_settings | tojson | safe }}
    };
</script>
<script src="{{ url_for('static', filename='js/radar/index.js') }}"></script>
{% endblock %}
