<!--
/* * Nom de l'application : ATM-RDC
 * Description : Source file: tariffs.html
 * Produit de : MOA Digital Agency, www.myoneart.com
 * Fait par : Aisance KALONJI, www.aisancekalonji.com
 * Auditer par : La CyberConfiance, www.cyberconfiance.com
 */
-->
{% extends "base.html" %}

{% block title %}Tarifs - ATM-RDC{% endblock %}
{% block page_title %}Configuration des Tarifs{% endblock %}
{% block page_subtitle %}Paramètres de facturation{% endblock %}

{% block content %}
<div class="bg-dark-400 rounded-xl border border-dark-100 overflow-hidden">
    <div class="p-4 border-b border-dark-100">
        <h3 class="font-semibold text-white">
            <i class="fas fa-dollar-sign mr-2 text-primary-400"></i>
            Grille Tarifaire
        </h3>
    </div>
    
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-dark-300">
                <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Nom</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Code</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Valeur</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Unité</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Description</th>
                    {% if current_user.role == 'superadmin' %}
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Actions</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody class="divide-y divide-dark-100">
                {% for tariff in tariffs %}
                <tr class="hover:bg-dark-300/50 transition-colors" data-testid="tariff-row-{{ tariff.id }}">
                    <td class="px-4 py-4">
                        <span class="font-medium text-white">{{ tariff.name }}</span>
                    </td>
                    <td class="px-4 py-4">
                        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-primary-500/20 text-primary-400">
                            {{ tariff.code }}
                        </span>
                    </td>
                    <td class="px-4 py-4">
                        <span class="text-white font-semibold">{{ tariff.value }}</span>
                    </td>
                    <td class="px-4 py-4 text-gray-400">{{ tariff.unit or '-' }}</td>
                    <td class="px-4 py-4 text-gray-400 text-sm max-w-xs truncate">{{ tariff.description or '-' }}</td>
                    {% if current_user.role == 'superadmin' %}
                    <td class="px-4 py-4">
                        <button onclick="openEditModal({{ tariff.id }}, '{{ tariff.name }}', {{ tariff.value }})" 
                                class="px-3 py-1.5 bg-primary-600/20 text-primary-400 hover:bg-primary-600/30 rounded-lg text-sm transition-colors" data-testid="btn-edit-{{ tariff.id }}">
                            <i class="fas fa-edit mr-1"></i> Modifier
                        </button>
                    </td>
                    {% endif %}
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="px-4 py-8 text-center text-gray-400">
                        Aucun tarif configuré
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div id="edit-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-dark-400 rounded-xl border border-dark-100 p-6 w-full max-w-md">
        <h3 class="text-lg font-semibold text-white mb-4">Modifier le Tarif</h3>
        
        <form method="POST" id="edit-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            
            <div class="mb-4">
                <label class="block text-sm text-gray-400 mb-2">Nom</label>
                <input type="text" id="edit-name" disabled
                       class="w-full px-4 py-2 bg-dark-300 border border-dark-100 rounded-lg text-gray-400">
            </div>
            
            <div class="mb-6">
                <label class="block text-sm text-gray-400 mb-2">Nouvelle valeur</label>
                <input type="number" name="value" id="edit-value" step="0.01" required
                       class="w-full px-4 py-2 bg-dark-300 border border-dark-100 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary-500" data-testid="input-value">
            </div>
            
            <div class="flex items-center gap-3">
                <button type="button" onclick="closeEditModal()" class="flex-1 py-2 px-4 bg-dark-300 text-gray-300 hover:text-white rounded-lg transition-colors">
                    Annuler
                </button>
                <button type="submit" class="flex-1 py-2 px-4 bg-primary-600 text-white hover:bg-primary-500 rounded-lg transition-colors" data-testid="btn-save-tariff">
                    Enregistrer
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    function openEditModal(id, name, value) {
        document.getElementById('edit-form').action = `/invoices/tariffs/${id}/update`;
        document.getElementById('edit-name').value = name;
        document.getElementById('edit-value').value = value;
        document.getElementById('edit-modal').classList.remove('hidden');
        document.getElementById('edit-modal').classList.add('flex');
    }
    
    function closeEditModal() {
        document.getElementById('edit-modal').classList.add('hidden');
        document.getElementById('edit-modal').classList.remove('flex');
    }
</script>
{% endblock %}
